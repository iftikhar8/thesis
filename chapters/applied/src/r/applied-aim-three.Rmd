---
title: "Graph theory analysis for my theoreticla chapter"
output: html_notebook
---

Packages required
```{r, include=FALSE}
library(igraph)
library(NetIndices)
```


Load the data
```{r,include=FALSE}
load(file="blackcod.rda")
load(file="reefs.rda")
```

Graph analysis for regions
```{r}

region.names <- c("Tweed","Byron","Ballina","Yamba","Solitary Is","Nambucca","Pt Macquarie","Crowdy Bay","Pt Stephens","Newcastle","Sydney","Wollongong","Jervis Bay","Ulladulla","Batemans Bay","Merimbula","Eden","Lord Howe Is","E&M Reefs")

X <- list(blackcod.2011.conn.regions,blackcod.2010.conn.regions,blackcod.2009.conn.regions,blackcod.2008.conn.regions,blackcod.2007.conn.regions,blackcod.2006.conn.regions,blackcod.2005.conn.regions,blackcod.2004.conn.regions)

Y <- do.call(cbind, X)
Y <- array(Y, dim=c(dim(X[[1]]),length(X)))

data.averages <- apply(Y, c(1,2), mean, na.rm=TRUE)

rownames(data.averages) <- blackcod.2011.regions$settle.region[-20]
colnames(data.averages) <-  blackcod.2011.regions$settle.region

graph.solitary <- graph.edgelist(data.averages[5:6,])


graph <- graph_from_adjacency_matrix(data.averages[,-20], weighted = TRUE)
V(graph)$desc <- region.names
graph.simple <- simplify(graph, remove.loops=T)
E(graph)$width
plot(graph.simple, edge.arrow.size=0.2, edge.curved=0.1, edge.width=E(graph)$weight/500, vertex.label.family="Helvetica", vertex.label.color="black", vertex.label.cex=0.9,vertex.label=region.names, vertex.label.font=2, layout=layout_randomly)

cut.off <- mean(E(graph)$weight)
par(mfrow=c(1,2))
graph.sp <- delete_edges(graph, E(graph)[weight < cut.off])
graph.sp <- delete_vertices(graph.sp, degree(graph.sp)==0)
mpas <- incident_edges(graph.sp, c(1), mode = "out")
ecol <- rep("gray80", ecount(graph.sp))
#ecol[mpas$NSW02] <- "orange"
ecol[1] <- "orange"
ecol[5] <- "orange"
#ecol[mpas$NSW18] <- "orange"
#ecol[mpas$NSW13] <- "orange"
#ecol[mpas$NSW19] <- "orange"
ecol[3] <- "orange"
ecol[6] <- "orange"
ecol[7] <- "orange"
vcol <- rep("grey80", vcount(graph.sp))
vcol[c(1,3,5,6,7)] <- "gold"

#plot(simplify(graph), vertex.color=vcol, edge.color=ecol, edge.arrow.size=0.2, edge.curved=0.1, edge.width=E(graph)$weight/500, vertex.label.family="Helvetica", vertex.label.color="black", vertex.label.cex=0.9,vertex.label=region.names, vertex.label.font=2, main="MPAs")

region.names.solitary <- c("Solitary Is","Nambucca","Pt Macquarie","Crowdy Bay","Pt Stephens","Newcastle","Sydney")
plot(graph.sp, edge.arrow.size=0.5,edge.curved=0.1,  edge.color=ecol, vertex.color=vcol, edge.width=E(graph.sp)$weight/300, vertex.label.family="Helvetica",vertex.label=region.names.solitary, vertex.label.color="black", vertex.label.cex=0.8,vertex.label.font=2, layout=layout_nicely)
                          


plot(graph.simple, edge.arrow.size=1.5, edge.curved=0.1, edge.width=E(graph)$weight/300, vertex.label.family="Helvetica", vertex.label.color="gray40", vertex.label.cex=0.9,vertex.label=region.names, vertex.label.font=2, vertex.shape="none")
```