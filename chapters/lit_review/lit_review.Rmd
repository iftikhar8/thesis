---
title: "Review Summary"
output: html_notebook
---


```{r}
#load libraries
library("tidyverse")

#load data
data.all <- read_csv("data/lit_review.csv")
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).

```{r}
#check the columns loaded
spec(data.all)

#get a summary of all the data
summary(data.all)
```

Subset data for analysis

```{r}
#extract data for single paper (is there a better way to do this?)
data.papers <- data.all %>% select(Paper_ID,Published,Oceanic_region,Years_total,Geographical_zone,Model_reuse,Model_name,Physical_model,Nested_submodels,Model_time_step) %>% 
  distinct(Paper_ID,Published,Oceanic_region,Years_total,Geographical_zone,Model_reuse,Model_name,Physical_model,Nested_submodels,Model_time_step)

data.all$Species_type <- as.factor(data.all$Species_type)

#papers looking at fish
data.fish <- filter(data.all,Species_type == "Fish")
```


##Summary

###The years the studies were published

```{r}
data.all <- mutate(data.all, movement = 
  Circatidal_migration |
  Pynocline_migration |
  Halocline_migration |
  Ontogentic_vertical_migration |
  Vertical_swimming_ability |
  Horizontal_swimming_ability |
  Sinking_velocity  | 
  Diel_vertical_migration)

data.all.test <- data.all %>% gather(Behaviours, Implemented, Passive_movement,movement)

data.papers.published <- data.all.test %>% select(Paper_ID,Published,Behaviours,Implemented) %>% distinct(Paper_ID,Published,Behaviours,Implemented)
data.papers.published <- filter(data.papers.published,Implemented == TRUE)
ggplot(data.papers.published, aes(Published)) + geom_bar(aes(fill = Behaviours)) +labs( x = "Publication year", y = "Number of papers")
```
###Published studies for each model

```{r}
source("sort_factor.R")
ggplot(data.all,aes(SortFactorBySize(DOI))) + geom_bar() + theme(axis.text.x=element_blank(),
                        axis.ticks.x=element_blank()) + xlab("Individual model runs per study")
```
###Different taxa

```{r}
data.taxa <- select(data.all,Species_type) %>% na.omit()
ggplot(data=data.taxa,aes(SortFactorBySize(Species_type))) + geom_bar() + coord_flip() + ylab("Number of models using the taxa") + xlab("Taxa")
```

###Oceangraphic regions
```{r}
data.regions <- data.all %>% select(Paper_ID,Oceanic_region) %>% distinct(Paper_ID,Oceanic_region)
data.regions %>% group_by(Oceanic_region) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
ggplot(data.regions,aes(SortFactorBySize(Oceanic_region)),fill=gray) + geom_bar() + coord_flip() + xlab("Oceanographic region") + ylab("Number of papers per region")
```


###Biophysical models used
```{r}
data.models <- data.all %>% select(Paper_ID,Model_name) %>% distinct(Paper_ID,Model_name)
data.models %>% group_by(Model_name) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
```


##Physical models

###Physical models used
```{r}
data.model.ocean <- data.all %>% select(Paper_ID,Physical_model) %>% distinct(Paper_ID,Physical_model)
data.model.ocean %>% group_by(Physical_model) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
```

###Timestep

```{r}
data.papers.timestep <- data.all %>% select(Paper_ID,Model_time_step) %>% distinct(Paper_ID,Model_time_step) %>% na.omit()
ggplot(data.papers.timestep,aes(Model_time_step)) + geom_density() + xlab("Time step (seconds)")
```


####Self-recruitment
```{r}
data.timestamp.sr <- select(data.all,Model_time_step,Self_recruitment_mean) %>% na.omit()
ggplot(data.timestamp.sr,aes(Model_time_step,Self_recruitment_mean)) + geom_point()
```
####Local retention
```{r}
data.timestamp.lr <- select(data.all,Model_time_step,Local_retention_mean) %>% na.omit()
ggplot(data.timestamp.lr,aes(Model_time_step,Local_retention_mean)) + geom_point()
```
####Settlement success
```{r}
data.timestamp.ss <- select(data.all,Model_time_step,Settlement_success_mean)
ggplot(na.omit(data.timestamp.ss
               ),aes(Model_time_step,Settlement_success_mean)) + geom_point()
```


###Model resolution
```{r}
data.papers.resolution <- data.all %>% select(Paper_ID,Model_resolution_min,Model_spatial_shape) %>% distinct(Paper_ID,Model_resolution_min,Model_spatial_shape)
data.papers.resolution.grid <- filter(data.papers.resolution,Model_spatial_shape == "Grid")
ggplot(data.papers.resolution.grid,aes(Model_resolution_min)) + geom_density() + xlab("The minimumn model resolution (seconds)")
```


####Self-recruitment
```{r}
data.resolution.sr <- data.all %>% filter(Model_spatial_shape == "Grid") %>%select(Model_resolution_min,Model_spatial_shape,Self_recruitment_mean,Nested_submodels) %>% na.omit() 
ggplot(data.resolution.sr,aes(Model_resolution_min,Self_recruitment_mean)) + geom_point()
ggplot(data.resolution.sr,aes(Nested_submodels,Self_recruitment_mean)) + geom_boxplot()
```
####Local retention
```{r}
data.resolution.lr <- data.all %>% filter(Model_spatial_shape == "Grid") %>%select(Model_resolution_min,Nested_submodels,Local_retention_mean) %>% na.omit()
ggplot(data.resolution.lr,aes(Model_resolution_min,Local_retention_mean)) + geom_point()
ggplot(data.resolution.lr,aes(Nested_submodels,Local_retention_mean)) + geom_boxplot()
```
####Settlement success
```{r}
data.resolution.ss <- data.all %>% filter(Model_spatial_shape == "Grid") %>%select(Model_resolution_min,Nested_submodels,Settlement_success_mean) %>% na.omit()
ggplot(data.resolution.ss,aes(Model_resolution_min,Settlement_success_mean)) + geom_point() + geom_smooth(method=lm)
ggplot(data.resolution.ss,aes(Nested_submodels,Settlement_success_mean)) + geom_boxplot()
```


##Biological models


###Pelagic larval durations
```{r}
ggplot(data.all,aes(x=PLD_fixed)) + geom_density()
data.all %>% group_by(PLD_type) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
```

###Mortality
```{r}
data.all %>% filter(Mortality == TRUE) %>% group_by(Mortality_function) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
```


###Sensory extent
```{r}
ggplot(data.all,aes(x=Sensory_extent)) + geom_density()
ggplot(data.all,aes(x=Sensory_extent,y=Self_recruitment_mean)) + geom_point()
ggplot(data.all,aes(x=Sensory_extent,y=Local_retention_mean)) + geom_point()
ggplot(data.all,aes(x=Sensory_extent,y=Settlement_success_mean)) + geom_point()
```

#Proportions of implemented behaviours
```{r}
data.all %>% group_by(Mortality) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
data.all %>% group_by(Growth) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
data.all %>% group_by(Sensory_ability) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
data.all %>% group_by(Settlement_competency_window) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
data.all %>% group_by(Orientation) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
```

#Proportions of swimming behaviours for ALL larvae
```{r}
larvae.swimming <- filter(data.all,Passive_movement==FALSE)
larvae.swimming %>% group_by(Horizontal_swimming_ability) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
larvae.swimming %>% group_by(Vertical_swimming_ability) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
larvae.swimming %>% group_by(Ontogentic_vertical_migration) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
larvae.swimming %>% group_by(Diel_vertical_migration) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
larvae.swimming %>% group_by(Halocline_migration) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
larvae.swimming %>% group_by(Circatidal_migration) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
larvae.swimming %>% group_by(Pynocline_migration) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
larvae.swimming %>% group_by(Sinking_velocity) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
larvae.swimming %>% group_by(Egg_buoyancy) %>% summarise (n = n()) %>% mutate(freq = n / sum(n))
```

##Comparisons


